name: Processar Coment√°rios

on:
  repository_dispatch:
    types: [new-comment, new-suggestion]

jobs:
  process-comment:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      
    - name: Processar novo coment√°rio
      if: github.event.action == 'new-comment'
      env:
        GITHUB_TOKEN: ${{ secrets.TOKEN_CLASSIC }}
        DISCUSSION_ID: "8561037"
      run: |
        curl -X POST \
          -H "Authorization: Bearer $GITHUB_TOKEN" \
          -H "Content-Type: application/json" \
          -d '{
            "query": "mutation { addDiscussionComment(input: { discussionId: \"'$DISCUSSION_ID'\", body: \"üë§ **'${{ github.event.client_payload.username }}'**\n\n‚≠ê Avalia√ß√£o: '${{ github.event.client_payload.rating }}'/5 estrelas\n\nüí¨ **Coment√°rio:**\n'${{ github.event.client_payload.comment }}'\n\n---\n*Enviado via sistema de coment√°rios*\" }) { comment { id } } }"
          }' \
          https://api.github.com/graphql

    - name: Processar nova sugest√£o
      if: github.event.action == 'new-suggestion'
      env:
        GITHUB_TOKEN: ${{ secrets.TOKEN_CLASSIC }}
        DISCUSSION_ID: "8561048"
      run: |
        curl -X POST \
          -H "Authorization: Bearer $GITHUB_TOKEN" \
          -H "Content-Type: application/json" \
          -d '{
            "query": "mutation { addDiscussionComment(input: { discussionId: \"'$DISCUSSION_ID'\", body: \"üë§ **'${{ github.event.client_payload.username }}'**\n\nüìù **'${{ github.event.client_payload.title }}'**\n\nüí° **Sugest√£o:**\n'${{ github.event.client_payload.suggestion }}'\n\n---\n*Enviado via sistema de sugest√µes*\" }) { comment { id } } }"
          }' \
          https://api.github.com/graphql
